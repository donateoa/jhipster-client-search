# Jhipster Client SearchBar 
This tool add a search bar to the code generated by Jhipster.  The searchBar will works for the entity generated with the option `filter` and only for angular version.

JDL example.
````
entity Foo{

}
filter Foo
````

## Copy EntityFilter into your Project
Copy the source folder [src/www/entity_filter](https://github.com/donateoa/jhipster-client-search/tree/master/src) into the `src/main/webapp/app/components`. 

NOTE: Once you copied the folder replace the name of your new project in entity-filter.module.ts

NOTE: until it have been done replace the name of project in also in
`src/generator/route.ts` and `src/generator/module.ts`

## Add search bar
Let JhipsterClientSearch make the job for you. Basically it clone the original code and add the Search Bar, extending or reuse the jhipster code whenever is possible.
before run the generator 
1. create a folder `src/main/webapp/app/pages` 
2. create a folder `src/main/webapp/app/pages/[outputFolder]` where you want to save the code and add a related module.ts. Let's say you would create a folder name `search` you will have
```
app/pages/search
app/pages/search/search.module.ts
```
search-module.ts
````
import { CommonModule } from '@angular/common';
import { NgModule } from '@angular/core';
@NgModule({
    declarations: [],
    imports: [
        CommonModule
    ]
})
export class SearchPagesModule {}

````
Update Navbar. Add the follow snippet changing the `jhiHasAnyAuthority` and the `[outputFolder]` and the desctription of menu too.
```
            <li *jhiHasAnyAuthority="'ROLE_ORGANIZATION_OPERATOR'" ngbDropdown class="nav-item dropdown pointer"
                routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
                <a class="nav-link dropdown-toggle" ngbDropdownToggle href="javascript:void(0);" id="entity-menu">
                    <span>
                        <fa-icon icon="th-list"></fa-icon>
                        <span jhiTranslate="domain.menu.operator.main">
                            Operators
                        </span>
                    </span>
                </a>
                <ul class="dropdown-menu" ngbDropdownMenu aria-labelledby="entity-menu">
                    <!-- data-search-client-root-[outputFolder] - search-client module will add new menu items here -->
                </ul>
            </li>
```
Add criteria to request-utils.
```
export const createRequestOption = (req?: any): HttpParams => {
    let options: HttpParams = new HttpParams();
    if (req) {
        Object.keys(req).forEach(key => {
            if (key !== 'sort' && key !== 'criteria') {
                options = options.set(key, req[key]);
            }
        });
        if (req.sort) {
            req.sort.forEach(val => {
                options = options.append('sort', val);
            });
        }
        if (req.criteria && req.criteria.length > 0) {
            req.criteria.forEach(criterion => {
                options = options.append(criterion.key, criterion.value);
            });
        }
    }
    return options;
};
```
Finally add the following route into your app.routing.ts
```
{
                    path: 'search',
                    loadChildren: './pages/search/search.module#SearchPagesModule'
                },
```
When you run this app, you will be promped for:
- Absolute jhipster app path: the path of your jhipster project, example `~your-project-folder/src/main/webapp/app`
- folder of entity to clone: the generated folder, example `foo`
- relative path of output folder: where you want to copy the data inside the folder app, example `search`
- role that can access the UI: example `ROLE_ADMIN`

Expected output:
- update the parent module importing the new module `FooModule`
- create `foo.module.ts` 
- create `foo.route.ts`
- create `foo.component.ts`
- create `foo.component.html`
- update `navbar.html`

## Run the Application
starts the application
````
npm run serve (npm start)
````

## Develop

Observations:

- During development, we use both `npm run watch-ts` (recompiles application on source changes) and `npm run watch-node` (restarts application on recompilation). `npm run dev` will add Source and Out folder for us.
- `npm run build-ts` only compiles the application
- `npm run serve` (`npm start`) only starts the application

To develop, we run:

```
npm run watch-ts
```

and in a separate terminal we run:
````
npm run watch-node
````
you can set [`projectFolder`,`outputFolder`,`role`,`entityFolder`] environment variables in order to skip some of prompts.
````
projectFolder=/your-project-folder/src/main/webapp/app outputFolder=search role=ROLE_ADMIN entityFolder=client npm run watch-node
````
